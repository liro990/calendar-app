
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>월중행사일정</title>
<style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    h1 { text-align: center; color: #2c3e50; }
    input[type="file"] { display: block; margin: 20px auto; }
    select { display: block; margin: 10px auto; }
    .event-card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin: 10px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .event-date { font-weight: bold; }
    .memo-input {
      margin-top: 8px;
      width: 100%;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>
</head>
<body>
<h1>월중행사일정</h1>

<select id="deptFilter">
<option value="">-부서 선택-</option>
</select>
<div id="events"></div>


<script>
/* ─────────────────────────────
   JSON 자동 로딩 & 화면 렌더링
────────────────────────────── */
fetch('final_monthly_events.json')
  .then(r => r.json())
  .then(data => {
    const deptFilter = document.getElementById('deptFilter');
    const eventsDiv  = document.getElementById('events');

    /* 날짜·요일 포맷 정리 */
  const events = data.map(e => {
  // "2025년 7월 1일" → "2025-07-01"
  const raw = e['날짜'].toString().trim()
               .replace('년','-')
               .replace('월','-')
               .replace('일','')
               .replace(/\s+/g,'');
  const d = new Date(raw);

  if (!isNaN(d)) {      // 파싱 성공
    const day = d.toLocaleDateString('ko-KR',{weekday:'short'});
    e.dateString = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} (${day})`;
  } else {              // 파싱 실패 → 원본 사용
    e.dateString = `${e['날짜']} (${e['요일']})`;
  }

  e.부서 = e.부서?.trim();
  e.행사 = e.행사?.trim();
  return e;
});
 

    /* 드롭다운 구축 */
    const deptList = [...new Set(events.map(e => e.부서).filter(Boolean))];
    deptFilter.innerHTML =
      '<option value="">-부서 선택-</option>' +
      deptList.map(d => `<option value="${d}">${d}</option>`).join('');
    deptFilter.addEventListener('change', () => render(events));

    /* 첫 렌더 */
    render(events);

    /* ─── 화면 출력 함수 ─── */
    function render(all) {
      const sel = deptFilter.value;
      const filtered = sel ? all.filter(e => e.부서 === sel) : all;

      /* 날짜별로 묶기 */
      const grouped = {};
      filtered.forEach(e => {
        (grouped[e.dateKey] ||= []).push(e);
      });

      /* 카드 생성 */
      eventsDiv.innerHTML = '';
      Object.keys(grouped).sort().forEach(date => {
        const list = grouped[date];
        const card = document.createElement('div');
        card.className = 'event-card';

        /* 날짜 헤더 */
        card.innerHTML = `<div class="event-date">${date}</div>`;

        /* 행사 목록(빈 값은 건너뜀) */
        list.forEach(item => {
          if (!item.행사) return;                // ⚑ 빈 행사 skip
          const line = `<div><strong>${item.부서}</strong>: ${item.행사}</div>`;
          card.insertAdjacentHTML('beforeend', line);
        });

        /* 메모 입력 */
        card.insertAdjacentHTML('beforeend',
          `<textarea class="memo-input"
                    placeholder="개인 메모 입력..."
                    oninput="saveMemo('${date}',this.value)">${loadMemo(date)}</textarea>`);
        eventsDiv.appendChild(card);
      });
    }

    /* 메모 저장·불러오기 (로컬) */
    window.saveMemo = (d,v)=>localStorage.setItem('memo-'+d,v);
    window.loadMemo = d=>localStorage.getItem('memo-'+d)||'';
  })
  .catch(err => console.error('행사 데이터를 불러오지 못했습니다:', err));
</script></body>
</html>
